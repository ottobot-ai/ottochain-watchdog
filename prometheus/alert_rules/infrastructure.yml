# Alert rules for infrastructure (CPU, memory, disk)

groups:
  - name: infrastructure
    rules:
      - alert: HighMemoryUsage
        expr: ottochain:node_memory_usage_percent > 90
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage on {{ $labels.instance }}"
          description: "Memory usage is above 90% for more than 5 minutes on {{ $labels.instance }}."

      - alert: CriticalMemoryUsage
        expr: ottochain:node_memory_usage_percent > 95
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Critical memory usage on {{ $labels.instance }}"
          description: "Memory usage is above 95% on {{ $labels.instance }}. System may become unresponsive."

      - alert: HighCPUUsage
        expr: ottochain:node_cpu_usage_percent > 90
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage on {{ $labels.instance }}"
          description: "CPU usage is above 90% for more than 5 minutes on {{ $labels.instance }}."

      - alert: DiskSpaceLow
        expr: ottochain:node_disk_usage_percent > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Low disk space on {{ $labels.instance }}"
          description: "Disk usage is above 80% on {{ $labels.instance }}."

      - alert: DiskSpaceCritical
        expr: ottochain:node_disk_usage_percent > 90
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Critical disk space on {{ $labels.instance }}"
          description: "Disk usage is above 90% on {{ $labels.instance }}. Immediate action required."

      - alert: HostDown
        expr: up{job=~"node-.*"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Host {{ $labels.instance }} is down"
          description: "Node exporter on {{ $labels.instance }} is unreachable for more than 2 minutes."

      - alert: HostClockSkew
        expr: abs(node_timex_offset_seconds) > 0.5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Clock skew detected on {{ $labels.instance }}"
          description: "System clock on {{ $labels.instance }} is more than 500ms out of sync."

      - alert: HostNetworkReceiveErrors
        expr: increase(node_network_receive_errs_total[5m]) > 0
        labels:
          severity: warning
        annotations:
          summary: "Network receive errors on {{ $labels.instance }}"
          description: "{{ $labels.device }} on {{ $labels.instance }} has encountered receive errors."

      - alert: HostOOMKillDetected
        expr: increase(node_vmstat_oom_kill[5m]) > 0
        labels:
          severity: critical
        annotations:
          summary: "OOM kill detected on {{ $labels.instance }}"
          description: "A process was killed due to Out Of Memory on {{ $labels.instance }}."
